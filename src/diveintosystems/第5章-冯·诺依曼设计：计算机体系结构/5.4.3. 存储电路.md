### 5.4.3. 存储电路

**Storage circuits** are used to construct computer memory for storing binary values. The type of computer memory built from storage circuits is called **static RAM** (SRAM). It is used to build CPU register storage and on-chip cache memory. Systems typically use **dynamic RAM** (DRAM) for main memory (RAM) storage. The capacitor-based design of DRAM requires that it be periodically refreshed with the value it stores, hence the "dynamic" moniker. SRAM is circuit-based storage that does not need to have its values refreshed, thus it is referred to as static RAM. Circuit-based memory is faster but more expensive than capacitor-based memory. As a result, SRAM tends to be used for storage at the top of the [memory hierarchy](https://diveintosystems.org/book/C11-MemHierarchy/mem_hierarchy.html#_the_memory_hierarchy) (CPU registers and on-chip cache memory), and DRAM for main memory (RAM) storage. In this chapter, we focus on circuit-based memory like SRAM.

**存储电路**用于构建用于存储二进制值的计算机内存。由存储电路构建的计算机内存类型称为**静态 RAM** (SRAM)。它用于构建 CPU 寄存器存储和片上高速缓存。系统通常使用**动态 RAM** (DRAM) 作为主存储器 (RAM) 存储。DRAM 的基于电容器的设计要求定期用其存储的值进行刷新，因此有“动态”的绰号。SRAM 是基于电路的存储，不需要刷新其值，因此被称为静态 RAM。基于电路的内存比基于电容器的内存更快，但更昂贵。因此，SRAM 往往用于[内存层次结构](https://diveintosystems.org/book/C11-MemHierarchy/mem_hierarchy.html#_the_memory_hierarchy) （CPU 寄存器和片上高速缓存）顶部的存储，而 DRAM 用于主存储器 (RAM) 存储。在本章中，我们重点介绍基于电路的存储器，例如 SRAM。

To store a value, a circuit must contain a feedback loop so that the value is retained by the circuit. In other words, a storage circuit’s value depends on its input values and also its currently stored value. When the circuit stores a value, its currently stored value and its inputs together produce an output that matches the currently stored value (i.e. the circuit continues to store the same value). When a new value is written into a storage circuit, the circuit’s input values change momentarily to modify the behavior of the circuit, which results in a new value being written into and stored in the circuit. Once written, the circuit resumes a steady state of storing the newly written value until the next write to the circuit occurs.
要存储一个值，电路必须包含一个反馈回路，以便电路保留该值。换句话说，存储电路的值取决于其输入值以及其当前存储的值。当电路存储一个值时，其当前存储的值和其输入一起产生与当前存储的值匹配的输出（即电路继续存储相同的值）。当将新值写入存储电路时，电路的输入值会瞬间改变以修改电路的行为，从而导致新值被写入并存储在电路中。写入后，电路将恢复存储新写入值的稳定状态，直到下一次写入电路。
#### [](https://diveintosystems.org/book/C5-Arch/storagecircs.html#_rs_latch)RS锁存器

A latch is a digital circuit that stores (or remembers) a 1-bit value. One example is a **reset-set latch** (or RS latch). An RS latch has two input values, S and R, and one output value, Q, which is also the value stored in the latch. An RS latch may additionally output NOT(Q), the negation of the stored value. [Figure 1](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figrslatch) shows an RS latch circuit for storing a single bit.
锁存器是一种存储（或记住）1 位值的数字电路。一个例子是 **复位锁存器** （或 RS 锁存器）。RS 锁存器有两个输入值 S 和 R，以及一个输出值 Q，该输出值也是存储在锁存器中的值。RS 锁存器还可以输出 NOT(Q)，即存储值的负数。[图 1](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figrslatch) 显示了用于存储单个位的 RS 锁存器电路。

![an RS Latch for storing 1-bit](https://diveintosystems.org/book/C5-Arch/_images/rslatch.png)

Figure 1. An RS latch circuit stores a 1-bit value.
图 1. RS 锁存电路存储 1 位值。

The first thing to note about the RS latch is the feedback loop from its outputs to its inputs: the output of the top NAND gate (Q) is input (a) to the bottom NAND gate, and the output of the bottom NAND gate (~Q) is input (b) to the top NAND gate. When inputs S and R are both 1, the RS latch stores the value Q. In other words, when S and R are both 1, the RS latch output value Q is stable. To see this behavior, consider [Figure 2](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figlatchstores1); this shows an RS latch that stores the value 1 (Q is 1). When R and S are both 1, the feedback input value (a) to the bottom NAND gate is the value of Q, which is 1, so the output of the bottom NAND gate is 0 (1 NAND 1 is 0). The feedback input value (b) to the top NAND gate is the output of the bottom NAND gate, which is 0. The other input to the top NAND gate is 1, the value of S. The output of the top gate is 1 (1 NAND 0 is 1). Thus, when S and R are both 1, this circuit continuously stores the value of Q (1 in this example).
关于 RS 锁存器，首先要注意的是从其输出到其输入的反馈回路：顶部 NAND 门 (Q) 的输出是 (a) 底部 NAND 门的输入，底部 NAND 门的输出 (~Q) 是 (b) 顶部 NAND 门的输入。当输入 S 和 R 都为 1 时，RS 锁存器存储值 Q。换句话说，当 S 和 R 都为 1 时，RS 锁存器输出值 Q 是稳定的。要查看此行为，请考虑[图 2](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figlatchstores1)；这显示了一个存储值 1（Q 为 1）的 RS 锁存器。当 R 和 S 都为 1 时，底部 NAND 门的反馈输入值 (a) 是 Q 的值，即 1，因此底部 NAND 门的输出为 0（1 NAND 1 为 0）。顶部 NAND 门的反馈输入值 (b) 是底部 NAND 门的输出，为 0。顶部 NAND 门的另一个输入是 1，即 S 的值。顶部门的输出为 1（1 NAND 0 为 1）。因此，当 S 和 R 均为 1 时，该电路会持续存储 Q 的值（本例中为 1）。

![An RS Latch that stores the value 1](https://diveintosystems.org/book/C5-Arch/_images/latchstores1.png)

Figure 2. An RS latch that stores a 1-bit value. R and S are both 1 when the latch stores a value. The stored value is output Q.
图 2. 存储 1 位值的 RS 锁存器。当锁存器存储值时，R 和 S 均为 1。存储的值是输出 Q。

To change the value stored in an RS latch, the value of exactly one of R or S is set to 0. When the latch stores the new value, R and S are set back to 1. Control circuitry around the RS latch ensures that R and S can never simultaneously be 0: at most one of them will have a value 0, and a value of 0 for one of R or S means that a value is being written into the RS latch. To store the value 0 in an RS latch, input R is set to 0 (and the value of S stays at 1). To store the value 1 in an RS latch, input S is set to 0 (and the value of R stays at 1). For example, assume that the RS latch currently stores 1. To write 0 into the latch, R’s value is set to 0. This means that the values 0 and 1 are input to the lower NAND gate which computes the result of (0 NAND 1), or is 1. This output value of 1 is also input b to the top NAND gate (shown in [Figure 3](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figwrite0) B). With a new b input value of 1 and the S input value 1, the upper NAND gate computes a new output value 0 for Q, which is also fed as input a into the lower NAND gate (shown in [Figure 3](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figwrite0) C). With a’s value 0 and b’s value 1, the latch now stores 0. When R is eventually set back to 1 the RS latch continues to store the value 0 (shown in [Figure 3](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figwrite0) D).

要更改 RS 锁存器中存储的值，必须将 R 或 S 中的一个的值设置为 0。当锁存器存储新值时，R 和 S 将重新设置为 1。RS 锁存器周围的控制电路确保 R 和 S 永远不会同时为 0：它们中最多只有一个值为 0，并且 R 或 S 中的一个值为 0 表示正在将值写入 RS 锁存器。要将值 0 存储在 RS 锁存器中，必须将输入 R 设置为 0（S 的值保持为 1）。要将值 1 存储在 RS 锁存器中，必须将输入 S 设置为 0（R 的值保持为 1）。例如，假设 RS 锁存器当前存储的是 1。要将 0 写入锁存器，R 的值需设置为 0。这意味着值 0 和 1 被输入到下方的 NAND 门，其计算结果为 (0 NAND 1)，即 1。该输出值 1 也是上方 NAND 门的输入 b（如 [图 3](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figwrite0) B 所示）。有了新的 b 输入值 1 和 S 输入值 1，上方 NAND 门为 Q 计算出一个新的输出值 0，该输出值也作为输入 a 馈入下方的 NAND 门（如 [图 3](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figwrite0) C 所示）。当 a 的值为 0 且 b 的值为 1 时，锁存器现在存储 0。当 R 最终设置回 1 时，RS 锁存器继续存储值 0（如 [图 3](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figwrite0) D 所示）。

![Set R to 0 to write 0 into the RS Latch](https://diveintosystems.org/book/C5-Arch/_images/latchwrite0.png)

Figure 3. To write 0 to an RS latch, momentarily set R to 0.
图 3. 要将 0 写入 RS 锁存器，请暂时将 R 设置为 0。
#### [](https://diveintosystems.org/book/C5-Arch/storagecircs.html#_gated_d_latch)门控 D 锁存器

A **gated D latch** adds circuitry to an RS latch to ensure that it never receives an input of 0 to both R and S simultaneously. [Figure 4](https://diveintosystems.org/book/C5-Arch/storagecircs.html#FiggatedD) shows the construction of a gated D latch.
**门控 D 锁存器** 在 RS 锁存器中添加电路，以确保它永远不会同时接收 R 和 S 的 0 输入。[图 4](https://diveintosystems.org/book/C5-Arch/storagecircs.html#FiggatedD) 显示了门控 D 锁存器的构造。

![Gated D latch combines an RS latch with added write control circuitry](https://diveintosystems.org/book/C5-Arch/_images/gatedD.png)

Figure 4. A gated D latch stores a 1-bit value. Its first set of NAND gates control writes to the RS latch and ensure that the values of R and S are never both simultaneously 0.
图 4. 门控 D 锁存器存储 1 位值。其第一组 NAND 门控制对 RS 锁存器的写入，并确保 R 和 S 的值永远不会同时为 0。

The data input (D) to the gated D latch is the value to store into the circuit (either 0 or 1). The Write Enable (WE) input controls writing a value into the RS latch. When WE is 0, the output from both NAND gates is 1, resulting in S and R input values of 1 to the RS latch (the RS latch stores a value). The gated D latch writes the value of D into the RS latch only when WE is 1. Because the data input (D) value is inverted before it is sent to the bottom NAND gate, the input of only one of the top or bottom NAND gates input is 1. This means that when the WE bit is 1, exactly one of R or S is 0. For example, when D is 1 and WE is 1, the top NAND computes (1 NAND 1) and the bottom NAND gate computes (O NAND 1). As a result, the input to S from the top NAND gate is 0 and the input to R from the bottom NAND gate is 1, resulting in writing the value 1 into the RS latch. When the WE input is 0, both NAND gates output 1, keeping R and S at 1. In other words, when WE is 0, the value of D has no effect on the value stored in the RS latch; only when WE is 1 is the value of D written into the latch. To write another value into the gated D latch, set D to the value to store and WE to 1.
门控 D 锁存器的数据输入 (D) 是要存储到电路中的值（0 或 1）。写入使能 (WE) 输入控制将值写入 RS 锁存器。当 WE 为 0 时，两个 NAND 门的输出均为 1，导致 RS 锁存器的 S 和 R 输入值为 1（RS 锁存器存储一个值）。仅当 WE 为 1 时，门控 D 锁存器才会将 D 的值写入 RS 锁存器。由于数据输入 (D) 值在发送到底部 NAND 门之前被反转，因此顶部或底部 NAND 门输入中只有一个的输入为 1。这意味着当 WE 位为 1 时，R 或 S 中恰好有一个为 0。例如，当 D 为 1 且 WE 为 1 时，顶部 NAND 计算（1 NAND 1），底部 NAND 门计算（O NAND 1）。因此，顶部 NAND 门对 S 的输入为 0，底部 NAND 门对 R 的输入为 1，从而将值 1 写入 RS 锁存器。当 WE 输入为 0 时，两个 NAND 门均输出 1，使 R 和 S 保持为 1。换句话说，当 WE 为 0 时，D 的值对存储在 RS 锁存器中的值没有影响；只有当 WE 为 1 时，D 的值才会写入锁存器。要将另一个值写入门控 D 锁存器，请将 D 设置为要存储的值，并将 WE 设置为 1。
#### [](https://diveintosystems.org/book/C5-Arch/storagecircs.html#_cpu_register)CPU 寄存器

Multibit storage circuits are built by linking several 1-bit storage circuits together. For example, combining 32 1-bit D latches together yields a 32-bit storage circuit that could be used as a 32-bit CPU register, as shown in [Figure 5](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figcpuregcircuit). The register circuit has two input values: a 32-bit data value and a 1-bit Write Enable signal. Internally, each 1-bit D latch takes as its D input one bit of the register’s 32-bit _Data in_ input, and each 1-bit D latch takes the register’s WE input as its WE input. The register’s output is the 32-bit value stored across the 32 1-bit D latches that make up the register circuit.
多位存储电路是通过将多个 1 位存储电路连接在一起而构建的。例如，将 32 个 1 位 D 锁存器组合在一起可产生一个 32 位存储电路，该存储电路可用作 32 位 CPU 寄存器，如 [图 5](https://diveintosystems.org/book/C5-Arch/storagecircs.html#Figcpuregcircuit) 所示。寄存器电路有两个输入值：一个 32 位数据值和一个 1 位写使能信号。在内部，每个 1 位 D 锁存器将寄存器的 32 位 _Data in_ 输入中的一位作为其 D 输入，并且每个 1 位 D 锁存器将寄存器的 WE 输入作为其 WE 输入。寄存器的输出是存储在组成寄存器电路的 32 个 1 位 D 锁存器中的 32 位值。

![A 32-bit CPU Register built from 32 1-bit Gated D latches](https://diveintosystems.org/book/C5-Arch/_images/register.png)

Figure 5. A CPU register is built from multiple gated D latches (32 of them for a 32-bit register). When its WE input is 1, the Data input is written into the register. Its Data output is the stored value.
图 5. CPU 寄存器由多个门控 D 锁存器组成（32 位寄存器有 32 个）。当其 WE 输入为 1 时，数据输入将写入寄存器。其数据输出是存储的值。